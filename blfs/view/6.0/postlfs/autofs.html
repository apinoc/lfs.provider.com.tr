<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "text/html; charset=iso-8859-1" />
    <title>
      Automate Mounting of File Systems
    </title>
    <link rel="stylesheet" href="../stylesheets/blfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.67.2" />
    <link rel="stylesheet" href="../stylesheets/blfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body id="blfs" class="6.0">
    <div class="navheader">
      <div class="headertitles">
        <h4>
          Beyond Linux From Scratch - Version 6.0
        </h4>
        <h3>
          Chapter&nbsp;3.&nbsp;After <span class="acronym">LFS</span>
          Configuration Issues
        </h3>
      </div>
      <ul class="headerlinks">
        <li class="prev">
          <a accesskey="p" href="compressdoc.html" title=
          "Compressing man and info pages">Prev</a>
          <p>
            Compressing man and info pages
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="netfs.html" title=
          "Configuring for Network Filesystems">Next</a>
          <p>
            Configuring for Network Filesystems
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="config.html" title=
          "Chapter&nbsp;3.&nbsp;After LFS Configuration Issues">Up</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch - Version 6.0">Home</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="titlepage">
        <a id="autofs" name="autofs"></a>
        <h1 class="sect1">
          Automate Mounting of File Systems
        </h1>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <div class="titlepage">
          <h2 class="sect2">
            Introduction to autofs
          </h2>
        </div>
        <p>
          The <span class="application">autofs</span> package contains
          userspace tools that work with the kernel to mount and un-mount
          removable file systems. This is useful for allowing users to mount
          floppies, cdroms and other removable storage devices without
          requiring the system administrator to mount the devices. This may
          not be ideal for all installations, so be aware of the risks before
          implementing this feature.
        </p>
        <div class="sect3" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title">
                  <a id="id2712265" name="id2712265"></a>Package information
                </h4>
              </div>
            </div>
          </div>
          <div class="itemizedlist">
            <ul compact="compact">
              <li>
                <p>
                  Download (HTTP): <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3.tar.bz2">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3.tar.bz2</span></a>
                </p>
              </li>
              <li>
                <p>
                  Download (FTP): <a href=
                  "ftp://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3.tar.bz2">
                  <span class=
                  "url">ftp://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3.tar.bz2</span></a>
                </p>
              </li>
              <li>
                <p>
                  Download MD5 sum: f43a09e94c4bd512ec58ac06e9d42c60
                </p>
              </li>
              <li>
                <p>
                  Download size: 122 KB
                </p>
              </li>
              <li>
                <p>
                  Estimated disk space required: 1.4 MB
                </p>
              </li>
              <li>
                <p>
                  Estimated build time: 0.01 SBU
                </p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect3" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title">
                  <a id="id2640010" name="id2640010"></a>Additional downloads
                </h4>
              </div>
            </div>
          </div>
          <div class="itemizedlist">
            <ul compact="compact">
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-strict.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-strict.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-bad_chdir.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-bad_chdir.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-mtab_lock.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-mtab_lock.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-non_block_ping.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-non_block_ping.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-signal-race-fix.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-signal-race-fix.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-sock-leak-fix.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-sock-leak-fix.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-replicated_server_select.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-replicated_server_select.patch</span></a>
                </p>
              </li>
              <li>
                <p>
                  Recommended Patch: <a href=
                  "http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-multi-over.patch">
                  <span class=
                  "url">http://ftp.kernel.org/pub/linux/daemons/autofs/v4/autofs-4.1.3-multi-over.patch</span></a>
                </p>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <div class="titlepage">
          <a id="autofs-kernel" name="autofs-kernel"></a>
          <h2 class="sect2">
            Installation of autofs
          </h2>
        </div>
        <p>
          Verify that kernel support has been compiled in or built as modules
          in the following areas:
        </p>
        <pre class="screen">File systems
        Kernel automounter version 4 support    Y or M
Network File Systems
        NFS file system support                 Y or M
        SMB file system support                 Y or M</pre>
        <p>
          Recompile and install the new kernel, if necessary.
        </p>
        <p>
          Install <span class="application">autofs</span> by running the
          following commands:
        </p>
        <pre class="userinput"><kbd class="command"><span><strong class=
        "command">patch -Np1 -i ../autofs-4.1.3-strict.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-bad_chdir.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-mtab_lock.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-non_block_ping.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-signal-race-fix.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-sock-leak-fix.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-replicated_server_select.patch &amp;&amp;
patch -Np1 -i ../autofs-4.1.3-multi-over.patch &amp;&amp;
./configure --prefix=/ --mandir=/usr/share/man &amp;&amp;
make</strong></span></kbd></pre>
        <p>
          Now, as the root user:
        </p>
        <pre class="userinput"><kbd class="command"><span><strong class=
        "command">make install &amp;&amp;
rm /etc/rc.d/init.d/autofs</strong></span></kbd></pre>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <div class="titlepage">
          <h2 class="sect2">
            Command explanations
          </h2>
        </div>
        <p>
          <span><strong class="command">rm
          /etc/rc.d/init.d/autofs</strong></span>: This command removes the
          installed script which only works on specific distributions.
        </p>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <div class="titlepage">
          <h2 class="sect2">
            Configuring autofs
          </h2>
        </div>
        <div class="sect3" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title">
                  <a id="autofs-config" name="autofs-config"></a>Config files
                </h4>
              </div>
            </div>
          </div>
          <p>
            <tt class="filename">/etc/sysconfig/autofs.conf</tt>, <tt class=
            "filename">/etc/auto.master</tt>, <tt class=
            "filename">/etc/auto.misc</tt>, and <tt class=
            "filename">/etc/auto.net</tt>
          </p>
        </div>
        <div class="sect3" lang="en" xml:lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title">
                  <a id="id2697249" name="id2697249"></a>Configuration
                  Information
                </h4>
              </div>
            </div>
          </div>
          <p>
            The installation process creates <tt class=
            "filename">auto.master</tt>, <tt class="filename">auto.misc</tt>
            and <tt class="filename">auto.net</tt>. You will replace the
            <tt class="filename">auto.master</tt> with the following
            commands.
          </p>
          <pre class="userinput"><kbd class="command"><span><strong class=
          "command">mv /etc/auto.master /etc/auto.master.bak &amp;&amp;
cat &gt; /etc/auto.master &lt;&lt; "EOF"</strong></span>
# Begin /etc/auto.master

/media  /etc/auto.misc

# End /etc/auto.master
<span><strong class="command">EOF</strong></span></kbd></pre>
          <div class="note">
            <div class="admonhead">
              <img alt="[Note]" src="../images/note.png" />
              <h3 class="admontitle">
                Note
              </h3>
            </div>
            <div class="admonbody">
              <p>
                This file mounts a new media directory over the one created
                by <span class="acronym">LFS</span> and will therefore hide
                any mounts made by the <tt class="filename">fstab</tt> file
                into that directory.
              </p>
            </div>
          </div>
          <p>
            While this package could be used to mount <span class=
            "acronym">NFS</span> shares and <span class="acronym">SMB</span>
            shares, that feature is not configured in these instructions.
            <span class="acronym">NFS</span> shares are covered on the next
            page.
          </p>
          <p>
            The <tt class="filename">auto.misc</tt> must be configured to
            your working hardware. The loaded configuration file should load
            your cdrom if <tt class="filename">/dev/cdrom</tt> is active or
            it can be edited to match your device setup and examples for
            floppies are available in the file and easily activated.
            Documentation for this file is available using the
            <span><strong class="command">man 5 autofs</strong></span>
            command.
          </p>
          <p>
            <a id="autofs-init" name="autofs-init"></a>Install the <tt class=
            "filename">/etc/rc.d/init.d/autofs</tt> mount script and
            <tt class="filename">/etc/sysconfig/autofs.conf</tt> support file
            included with the <a href=
            "../introduction/bootscripts.html">blfs-bootscripts-6.0</a>
            package.
          </p>
          <pre class="userinput"><kbd class="command"><span><strong class=
          "command">make install-autofs</strong></span></kbd></pre>
          <p>
            The time-out variable is set in <tt class=
            "filename">/etc/sysconfig/autofs.conf</tt>. The installed file
            sets a default of 60 seconds of inactivity before unmounting the
            device. A much shorter time may be necessary to protect buffer
            writing to a floppy if users tend to remove the media prior to
            the timeout setting.
          </p>
        </div>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <div class="titlepage">
          <h2 class="sect2">
            Contents
          </h2>
        </div>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong><span class="segtitle">Installed
              Program:</span></strong> <span class="seg">automount</span>
            </div>
            <div class="seg">
              <strong><span class="segtitle">Installed
              Libraries:</span></strong> <span class="seg">autofs
              modules</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            <a id="id2651185" name="id2651185"></a>Short Descriptions
          </h3>
          <dl>
            <dt>
              <a id="automount" name="automount"></a><span class=
              "term"><span><strong class=
              "command">automount</strong></span></span>
            </dt>
            <dd>
              <p>
                is the daemon that performs the mounting when a request is
                made for the device.
              </p>
            </dd>
          </dl>
        </div>
      </div>
      <p class="updated">
        Last updated on 2005-02-09 14:53:24 -0700
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="compressdoc.html" title=
          "Compressing man and info pages">Prev</a>
          <p>
            Compressing man and info pages
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="netfs.html" title=
          "Configuring for Network Filesystems">Next</a>
          <p>
            Configuring for Network Filesystems
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="config.html" title=
          "Chapter&nbsp;3.&nbsp;After LFS Configuration Issues">Up</a>.
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch - Version 6.0">Home</a>.
        </li>
      </ul>
    </div>
  </body>
</html>
