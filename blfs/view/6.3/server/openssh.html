<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=iso-8859-1" />
    <title>
      OpenSSH-4.7p1
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-6.3">
    <div class="navheader">
      <h4>
        Beyond Linux<sup>®</sup> From Scratch - Version 6.3
      </h4>
      <h3>
        Chapter&nbsp;19.&nbsp;Major Servers
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="nfs-utils.html" title=
          "NFS Utilities-1.1.2">Prev</a>
          <p>
            NFS Utilities-1.1.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="proftpd.html" title="ProFTPD-1.3.0">Next</a>
          <p>
            ProFTPD-1.3.0
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="majorservers.html" title=
          "Chapter&nbsp;19.&nbsp;Major Servers">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch - Version 6.3">Home</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <h1 class="sect1">
        <a id="openssh" name="openssh"></a>OpenSSH-4.7p1
      </h1>
      <div class="package" lang="en" xml:lang="en">
        <h2 class="sect2">
          Introduction to OpenSSH
        </h2>
        <p>
          The <span class="application">OpenSSH</span> package contains
          <span class="command"><strong>ssh</strong></span> clients and the
          <span class="command"><strong>sshd</strong></span> daemon. This is
          useful for encrypting authentication and subsequent traffic over a
          network.
        </p>
        <h3>
          Package Information
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li>
              <p>
                Download (HTTP): <a class="ulink" href=
                "http://sunsite.ualberta.ca/pub/OpenBSD/OpenSSH/portable/openssh-4.7p1.tar.gz">
                http://sunsite.ualberta.ca/pub/OpenBSD/OpenSSH/portable/openssh-4.7p1.tar.gz</a>
              </p>
            </li>
            <li>
              <p>
                Download (FTP): <a class="ulink" href=
                "ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-4.7p1.tar.gz">
                ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-4.7p1.tar.gz</a>
              </p>
            </li>
            <li>
              <p>
                Download MD5 sum: 50a800fd2c6def9e9a53068837e87b91
              </p>
            </li>
            <li>
              <p>
                Download size: 968 KB
              </p>
            </li>
            <li>
              <p>
                Estimated disk space required: 16.2 MB
              </p>
            </li>
            <li>
              <p>
                Estimated build time: 0.5 SBU (additional 1.2 SBU to run the
                test suite)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          OpenSSH Dependencies
        </h3>
        <h4>
          Required
        </h4>
        <p class="required">
          <a class="xref" href="../postlfs/openssl.html" title=
          "OpenSSL-0.9.8g">OpenSSL-0.9.8g</a>
        </p>
        <h4>
          Optional
        </h4>
        <p class="optional">
          <a class="xref" href="../postlfs/linux-pam.html" title=
          "Linux-PAM-0.99.10.0">Linux-PAM-0.99.10.0</a>, <a class="xref"
          href="../basicnet/tcpwrappers.html" title="TCP Wrapper-7.6">TCP
          Wrapper-7.6</a>, <a class="xref" href="../x/installing.html" title=
          "Chapter&nbsp;23.&nbsp;X Window System Environment">X Window
          System</a>, <a class="xref" href="../postlfs/mitkrb.html" title=
          "MIT Kerberos V5-1.6">MIT Kerberos V5-1.6</a> or <a class="xref"
          href="../postlfs/heimdal.html" title="Heimdal-1.1">Heimdal-1.1</a>,
          <a class="xref" href="../basicnet/net-tools.html" title=
          "Net-tools-1.60">Net-tools-1.60</a>, <a class="xref" href=
          "../general/sysstat.html" title="Sysstat-7.0.4">Sysstat-7.0.4</a>,
          <a class="ulink" href=
          "http://www.thrysoee.dk/editline/">libedit</a> (provides a
          command-line history feature to <span class=
          "command"><strong>sftp</strong></span>), <a class="ulink" href=
          "http://www.opensc-project.org/">OpenSC</a>, and <a class="ulink"
          href=
          "http://www.citi.umich.edu/projects/smartcard/sectok.html">libsectok</a>
        </p>
        <p class="usernotes">
          User Notes: <a class="ulink" href=
          "http://wiki.linuxfromscratch.org/blfs/wiki/OpenSSH">http://wiki.linuxfromscratch.org/blfs/wiki/OpenSSH</a>
        </p>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <h2 class="sect2">
          Installation of OpenSSH
        </h2>
        <p>
          <span class="application">OpenSSH</span> runs as two processes when
          connecting to other computers. The first process is a privileged
          process and controls the issuance of privileges as necessary. The
          second process communicates with the network. Additional
          installation steps are necessary to set up the proper environment,
          which are performed by issuing the following commands as the
          <code class="systemitem">root</code> user:
        </p>
        <pre class="root">
<kbd class="command">install -v -m700 -d /var/lib/sshd &amp;&amp;
chown -v root:sys /var/lib/sshd &amp;&amp;
groupadd -g 50 sshd &amp;&amp;
useradd -c 'sshd PrivSep' -d /var/lib/sshd -g sshd \
    -s /bin/false -u 50 sshd</kbd>
</pre>
        <p>
          <span class="application">OpenSSH</span> is very sensitive to
          changes in the linked <span class="application">OpenSSL</span>
          libraries. If you recompile <span class=
          "application">OpenSSL</span>, <span class=
          "application">OpenSSH</span> may fail to startup. An alternative is
          to link against the static <span class="application">OpenSSL</span>
          library. To link against the static library, execute the following
          command:
        </p>
        <pre class="userinput">
<kbd class=
"command">sed -i 's@-lcrypto@/usr/lib/libcrypto.a -ldl@' configure</kbd>
</pre>
        <p>
          Install <span class="application">OpenSSH</span> by running the
          following commands:
        </p>
        <pre class="userinput">
<kbd class="command">sed -i 's@ -ldes@@' configure &amp;&amp;
./configure --prefix=/usr --sysconfdir=/etc/ssh --datadir=/usr/share/sshd \
    --libexecdir=/usr/lib/openssh --with-md5-passwords \
    --with-privsep-path=/var/lib/sshd \
    --with-xauth=/usr/bin/xauth &amp;&amp;
make</kbd>
</pre>
        <p>
          If you linked <span class="application">tcp_wrappers</span> into
          the build using the <code class="option">--with-tcp-wrappers</code>
          parameter, ensure you add 127.0.0.1 to the sshd line in
          <code class="filename">/etc/hosts.allow</code> if you have a
          restrictive <code class="filename">/etc/hosts.deny</code> file, or
          the test suite will fail. Additionally, the testsuite requires an
          installed copy of <span class="command"><strong>scp</strong></span>
          to complete the mulitplexing tests. To run the test suite, issue
          the following commnds as the <code class="systemitem">root</code>
          user:
        </p>
        <pre class="root">
<kbd class="command">if test -f /usr/bin/scp
then
    mv /usr/bin/scp /usr/bin/scp-bak
fi &amp;&amp;
cp scp /usr/bin/scp &amp;&amp;
make tests 2&gt;&amp;1 | tee check.log
grep "FATAL" check.log</kbd>
</pre>
        <p>
          If the above command produces no 'FATAL' errors, then proceed with
          the installation, again as the <code class="systemitem">root</code>
          user:
        </p>
        <pre class="root">
<kbd class="command">rm /usr/bin/scp &amp;&amp;
if test -f /usr/bin/scp-bak
then
    rm /usr/bin/scp-bak
fi &amp;&amp;
make install &amp;&amp;
install -v -m755 -d /usr/share/doc/openssh-4.7p1 &amp;&amp;
install -v -m644 INSTALL LICENCE OVERVIEW README* WARNING.RNG \
    /usr/share/doc/openssh-4.7p1</kbd>
</pre>
      </div>
      <div class="commands" lang="en" xml:lang="en">
        <h2 class="sect2">
          Command Explanations
        </h2>
        <p>
          <span class="command"><strong>sed -i 's@ -ldes@@'
          configure</strong></span>: This command fixes a build crash if you
          used the <code class="option">--with-kerberos5</code> parameter and
          you built the <span class="application">Heimdal</span> package in
          accordance with the BLFS instructions. The command is harmless in
          all other instances.
        </p>
        <p>
          <em class="parameter"><code>--sysconfdir=/etc/ssh</code></em>: This
          prevents the configuration files from being installed in
          <code class="filename">/usr/etc</code>.
        </p>
        <p>
          <em class="parameter"><code>--datadir=/usr/share/sshd</code></em>:
          This switch puts the Ssh.bin file (used for SmartCard
          authentication) in <code class="filename">/usr/share/sshd</code>.
        </p>
        <p>
          <em class="parameter"><code>--with-md5-passwords</code></em>: This
          is required with the default configuration of Shadow password suite
          in LFS.
        </p>
        <p>
          <em class=
          "parameter"><code>--libexecdir=/usr/lib/openssh</code></em>: This
          parameter changes the installation path of some programs to
          <code class="filename">/usr/lib/openssh</code> instead of
          <code class="filename">/usr/libexec</code>.
        </p>
        <p>
          <em class="parameter"><code>--with-pam</code></em>: This parameter
          enables <span class="application">Linux-PAM</span> support in the
          build.
        </p>
        <p>
          <em class=
          "parameter"><code>--with-xauth=/usr/bin/xauth</code></em>: Set the
          default location for the <span class=
          "command"><strong>xauth</strong></span> binary for X
          authentication. Change the location if <span class=
          "command"><strong>xauth</strong></span> will be installed to a
          different path. This can also be controlled from <code class=
          "filename">sshd_config</code> with the XAuthLocation keyword. You
          can omit this switch if <span class="application">Xorg</span> is
          already installed.
        </p>
      </div>
      <div class="configuration" lang="en" xml:lang="en">
        <h2 class="sect2">
          Configuring OpenSSH
        </h2>
        <div class="sect3" lang="en" xml:lang="en">
          <h3 class="sect3">
            <a id="openssh-config" name="openssh-config"></a>Config Files
          </h3>
          <p>
            <code class="filename">~/.ssh/*</code>, <code class=
            "filename">/etc/ssh/ssh_config</code>, and <code class=
            "filename">/etc/ssh/sshd_config</code>
          </p>
          <p>
            There are no required changes to any of these files. However, you
            may wish to view the <code class="filename">/etc/ssh/</code>
            files and make any changes appropriate for the security of your
            system. One recommended change is that you disable <code class=
            "systemitem">root</code> login via <span class=
            "command"><strong>ssh</strong></span>. Execute the following
            command as the <code class="systemitem">root</code> user to
            disable <code class="systemitem">root</code> login via
            <span class="command"><strong>ssh</strong></span>:
          </p>
          <pre class="root">
<kbd class=
"command">echo "PermitRootLogin no" &gt;&gt; /etc/ssh/sshd_config</kbd>
</pre>
          <p>
            If you added <span class="application">LinuxPAM</span> support,
            then you will need to add a configuration file for <span class=
            "application">sshd</span>. Issue the following commands as the
            <code class="systemitem">root</code> user:
          </p>
          <pre class="root">
<kbd class=
"command">sed 's@d/login@d/sshd@g' /etc/pam.d/login &gt; /etc/pam.d/sshd &amp;&amp;
chmod 644 /etc/pam.d/sshd</kbd>
</pre>
          <p>
            Additional configuration information can be found in the man
            pages for <span class="command"><strong>sshd</strong></span>,
            <span class="command"><strong>ssh</strong></span> and
            <span class="command"><strong>ssh-agent</strong></span>.
          </p>
        </div>
        <div class="sect3" lang="en" xml:lang="en">
          <h3 class="sect3">
            <a id="openssh-init" name="openssh-init"></a>Boot Script
          </h3>
          <p>
            To start the SSH server at system boot, install the <code class=
            "filename">/etc/rc.d/init.d/sshd</code> init script included in
            the <a class="xref" href="../introduction/bootscripts.html"
            title="BLFS Boot Scripts">blfs-bootscripts-20080816</a> package.
          </p>
          <pre class="root">
<kbd class="command">make install-sshd</kbd>
</pre>
        </div>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <h2 class="sect2">
          Contents
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Installed Programs:</strong>
              <span class="segbody">scp, sftp, sftp-server, slogin, ssh,
              sshd, ssh-add, ssh-agent, ssh-keygen, ssh-keyscan, and
              ssh-keysign</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Libraries:</strong>
              <span class="segbody">None</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Directories:</strong>
              <span class="segbody">/etc/ssh, /var/lib/sshd and
              /usr/share/doc/openssh-4.7p1</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Short Descriptions
          </h3>
          <table border="0">
            <col align="left" valign="top" />
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="scp" name="scp"></a><span class=
                    "term"><span class="command"><strong>scp</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a file copy program that acts like <span class=
                    "command"><strong>rcp</strong></span> except it uses an
                    encrypted protocol.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="sftp" name="sftp"></a><span class=
                    "term"><span class=
                    "command"><strong>sftp</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is an FTP-like program that works over SSH1 and SSH2
                    protocols.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="sftp-server" name="sftp-server"></a><span class=
                    "term"><span class=
                    "command"><strong>sftp-server</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is an SFTP server subsystem. This program is not normally
                    called directly by the user.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="slogin" name="slogin"></a><span class=
                    "term"><span class=
                    "command"><strong>slogin</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a symlink to <span class=
                    "command"><strong>ssh</strong></span>.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ssh" name="ssh"></a><span class=
                    "term"><span class="command"><strong>ssh</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is an <span class=
                    "command"><strong>rlogin</strong></span>/<span class=
                    "command"><strong>rsh</strong></span>-like client program
                    except it uses an encrypted protocol.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="sshd" name="sshd"></a><span class=
                    "term"><span class=
                    "command"><strong>sshd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a daemon that listens for <span class=
                    "command"><strong>ssh</strong></span> login requests.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ssh-add" name="ssh-add"></a><span class=
                    "term"><span class=
                    "command"><strong>ssh-add</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a tool which adds keys to the <span class=
                    "command"><strong>ssh-agent</strong></span>.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ssh-agent" name="ssh-agent"></a><span class=
                    "term"><span class=
                    "command"><strong>ssh-agent</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is an authentication agent that can store private keys.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ssh-keygen" name="ssh-keygen"></a><span class=
                    "term"><span class=
                    "command"><strong>ssh-keygen</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a key generation tool.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ssh-keyscan" name="ssh-keyscan"></a><span class=
                    "term"><span class=
                    "command"><strong>ssh-keyscan</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a utility for gathering public host keys from a number
                    of hosts.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="ssh-keysign" name="ssh-keysign"></a><span class=
                    "term"><span class=
                    "command"><strong>ssh-keysign</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is used by <span class=
                    "command"><strong>ssh</strong></span> to access the local
                    host keys and generate the digital signature required
                    during hostbased authentication with SSH protocol version
                    2. This program is not normally called directly by the
                    user.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <p class="updated">
        Last updated on 2008-05-09 08:00:42 -0500
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="nfs-utils.html" title=
          "NFS Utilities-1.1.2">Prev</a>
          <p>
            NFS Utilities-1.1.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="proftpd.html" title="ProFTPD-1.3.0">Next</a>
          <p>
            ProFTPD-1.3.0
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="majorservers.html" title=
          "Chapter&nbsp;19.&nbsp;Major Servers">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch - Version 6.3">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
